<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DAISIEprep">
<title>Tutorial â€¢ DAISIEprep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
<meta property="og:description" content="DAISIEprep">
<meta property="og:image" content="https://joshwlambert.github.io/DAISIEprep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DAISIEprep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Performance.html">Performance</a>
    <a class="dropdown-item" href="../articles/Tutorial.html">Tutorial</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="Tutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tutorial</h1>
            
      
      
      <div class="d-none name"><code>Tutorial.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joshwlambert.github.io/DAISIEprep">DAISIEprep</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fmichonneau/phylobase" class="external-link">phylobase</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'phylobase'</span>
<span class="co">#&gt; The following object is masked from 'package:ape':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     edges</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/" class="external-link">ggtree</a></span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;">ggtree v3.3.1.901 For help:</span></span>
<span class="co"><span style="color: #949494;">#&gt; https://yulab-smu.top/treedata-book/</span></span>
<span class="co"><span style="color: #949494;">#&gt; </span></span>
<span class="co"><span style="color: #949494;">#&gt; If you use the ggtree package suite in published research, please cite</span></span>
<span class="co"><span style="color: #949494;">#&gt; the appropriate paper(s):</span></span>
<span class="co"><span style="color: #949494;">#&gt; </span></span>
<span class="co"><span style="color: #949494;">#&gt; Guangchuang Yu, David Smith, Huachen Zhu, Yi Guan, Tommy Tsan-Yuk Lam.</span></span>
<span class="co"><span style="color: #949494;">#&gt; ggtree: an R package for visualization and annotation of phylogenetic</span></span>
<span class="co"><span style="color: #949494;">#&gt; trees with their covariates and other associated data. Methods in</span></span>
<span class="co"><span style="color: #949494;">#&gt; Ecology and Evolution. 2017, 8(1):28-36. doi:10.1111/2041-210X.12628</span></span>
<span class="co"><span style="color: #949494;">#&gt; </span></span>
<span class="co"><span style="color: #949494;">#&gt; S Xu, Z Dai, P Guo, X Fu, S Liu, L Zhou, W Tang, T Feng, M Chen, L</span></span>
<span class="co"><span style="color: #949494;">#&gt; Zhan, T Wu, E Hu, Y Jiang, X Bo, G Yu. ggtreeExtra: Compact</span></span>
<span class="co"><span style="color: #949494;">#&gt; visualization of richly annotated phylogenetic data. Molecular Biology</span></span>
<span class="co"><span style="color: #949494;">#&gt; and Evolution. 2021, 38(9):4039-4042. doi: 10.1093/molbev/msab166</span></span>
<span class="co"><span style="color: #949494;">#&gt; </span></span>
<span class="co"><span style="color: #949494;">#&gt; Guangchuang Yu. Using ggtree to visualize data on tree-like structures.</span></span>
<span class="co"><span style="color: #949494;">#&gt; Current Protocols in Bioinformatics. 2020, 69:e96. doi:10.1002/cpbi.96</span></span>
<span class="co"><span style="color: #949494;">#&gt; </span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ggtree'</span>
<span class="co">#&gt; The following object is masked from 'package:phylobase':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     MRCA</span>
<span class="co">#&gt; The following object is masked from 'package:ape':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     rotate</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GuangchuangYu/ggimage" class="external-link">ggimage</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">castor</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: Rcpp</span></code></pre></div>
<p>First we simulate a phylogeny using the package <code>ape</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span>
  <span class="fl">1</span>,
  kind <span class="op">=</span> <span class="st">"Mersenne-Twister"</span>,
  normal.kind <span class="op">=</span> <span class="st">"Inversion"</span>,
  sample.kind <span class="op">=</span> <span class="st">"Rejection"</span>
<span class="op">)</span>
<span class="va">phylo</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html" class="external-link">rcoal</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<p><code>DAISIEprep</code> requires the species names (tip labels) in the phylogeny to be formatted as genus name and species name separated by an underscore. They can also optionally have tags appended after the species name. This is common if there are multiple tips in the phylogeny for a single species because multiple populations have been sampled and sequenced.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylo</span><span class="op">$</span><span class="va">tip.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bird_a"</span>, <span class="st">"bird_b"</span>, <span class="st">"bird_c"</span>, <span class="st">"bird_d"</span>, <span class="st">"bird_e"</span>, <span class="st">"bird_f"</span>,
                     <span class="st">"bird_g"</span>, <span class="st">"bird_h"</span>, <span class="st">"bird_i"</span>, <span class="st">"bird_j"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot%20phylogeny-1.png" width="700"></p>
<p>Then we convert to the phylogeny to a <code>phylo4</code> class defined in the package <code>phylobase</code>. This allows users to easily work with species data for each tip in the phylogeny, for example island endemicity status.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylo</span> <span class="op">&lt;-</span> <span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/phylo4-methods.html" class="external-link">phylo4</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span>
<span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/treePlot-methods.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial_files/figure-html/convert%20phylo%20to%20phylo4-1.png" width="700"></p>
<p>Now we have a phylogeny in the <code>phylo4</code> format we can easily append data. First we randomly simulate island endemicity patterns, assuming each species has an equal probability of being not on the island (<code>"not_present"</code>), endemic to the island (<code>"endemic"</code>) or non-endemic to the island (<code>"nonendemic"</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">endemicity_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not_present"</span>, <span class="st">"endemic"</span>, <span class="st">"nonendemic"</span><span class="op">)</span>, 
  size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/labels-methods.html" class="external-link">tipLabels</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span><span class="op">)</span>, 
  replace <span class="op">=</span> <span class="cn">TRUE</span>,
  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Next we can add the endemicity data to our phylogenetic data using the <code>phylo4d</code> class, again from the <code>phylobase</code> package. This call is designed for phylogenetic and trait data to be stored together. The endemicity status needs to be converted to a data frame in order for the column to be labelled correctly.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylod</span> <span class="op">&lt;-</span> <span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/phylo4d-methods.html" class="external-link">phylo4d</a></span><span class="op">(</span><span class="va">phylo</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">endemicity_status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can now visualise our phylogeny with the island endemicity status plotted at the tips. This uses the <code>ggtree</code> and <code>ggplot2</code> packages.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_phylod.html">plot_phylod</a></span><span class="op">(</span>phylod <span class="op">=</span> <span class="va">phylod</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot%20phylogeny%20with%20tip%20data-1.png" width="700"></p>
<p>Now that we can see the tips that are present on the island we can start to extract them to form our island community data set that can be used in the <code>DAISIE</code> R package to fit likelihood models of island colonisation and diversification.</p>
<p>Before we extract species we will first create an object to store all of the island colonists information. This uses the <code>island_tbl</code> class introduced in this package (<code>DAISIEprep</code>). The <code>island_tbl</code> is an S4 class that holds a data. This <code>island_tbl</code> object can then easily be converted to a <code>DAISIE_datatable</code> using the function <code>as_daisie_datatable</code> (more information on this to below).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/island_tbl.html">island_tbl</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">island_tbl</span>
<span class="co">#&gt; Class:  Island_tbl </span>
<span class="co">#&gt; [1] clade_name      status          missing_species branching_times</span>
<span class="co">#&gt; [5] min_age        </span>
<span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></code></pre></div>
<p>We can see that this is a class containing an empty data frame. In order to fill this data frame with information on the island colonisation and diversification events we can run:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_island_species.html">extract_island_species</a></span><span class="op">(</span>
  phylod <span class="op">=</span> <span class="va">phylod</span>, 
  extraction_method <span class="op">=</span> <span class="st">"min"</span>
<span class="op">)</span>
<span class="va">island_tbl</span>
<span class="co">#&gt; Class:  Island_tbl </span>
<span class="co">#&gt;   clade_name     status missing_species branching_times min_age</span>
<span class="co">#&gt; 1     bird_g nonendemic               0    0.380034....      NA</span>
<span class="co">#&gt; 2     bird_i    endemic               0    0.049605....      NA</span></code></pre></div>
<p>However, if we do not want to extract the minimum colonisation time before the present, and instead want to extract the most likely colonisation from ancestral state reconstruction we need to know the probability of the ancestors of the island species being on the island to determine the time of colonisation. To do this we can fit one of many ancestral state reconstruction methods. Here we use maximum parsimony as it is a simple method that should prove reliable for reconstructing the ancestral species areas (i.e.Â on the island or not on the island). First we translate our extant species endemicity status to a numeric representation of whether that species is on the island. We add one as the ancestral state reconstruction method cannot handle zero as a state.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tip_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">endemicity_status</span> <span class="op">&lt;-</span> <span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/tdata-methods.html" class="external-link">tipData</a></span><span class="op">(</span><span class="va">phylod</span><span class="op">)</span><span class="op">$</span><span class="va">endemicity_status</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">endemicity_status</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^not_present$"</span>, x <span class="op">=</span> <span class="va">endemicity_status</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tip_states</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^nonendemic$"</span>, x <span class="op">=</span> <span class="va">endemicity_status</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tip_states</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^endemic$"</span>, x <span class="op">=</span> <span class="va">endemicity_status</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tip_states</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>The maximum parsimony ancestral state reconstruction is from the R package <code>castor</code>. The <code>castor</code> package only works with S3 <code>phylo</code> objects, so we need to convert the phylogeny back to this type and then run the analysis.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">phylo</span>, <span class="st">"phylo"</span><span class="op">)</span>
<span class="va">asr</span> <span class="op">&lt;-</span> <span class="fu">castor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/castor/man/asr_max_parsimony.html" class="external-link">asr_max_parsimony</a></span><span class="op">(</span>
  tree <span class="op">=</span> <span class="va">phylo</span>,
  tip_states <span class="op">=</span> <span class="va">tip_states</span>,
  transition_costs <span class="op">=</span> <span class="st">"sequential"</span>
<span class="op">)</span></code></pre></div>
<p>This provides us with a matrix with the probabilities of the states (island presence/absence) at each node in the phylogeny. The first column of the matrix is not present on the island and the second colum of the matrix is present on the island.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not_present"</span>, <span class="st">"nonendemic"</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span><span class="op">)</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not_present"</span>, <span class="st">"nonendemic"</span>, <span class="st">"endemic"</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span>
<span class="co">#&gt;       not_present nonendemic endemic</span>
<span class="co">#&gt;  [1,]           1          0       0</span>
<span class="co">#&gt;  [2,]           1          0       0</span>
<span class="co">#&gt;  [3,]           1          0       0</span>
<span class="co">#&gt;  [4,]           0          1       0</span>
<span class="co">#&gt;  [5,]           1          0       0</span>
<span class="co">#&gt;  [6,]           1          0       0</span>
<span class="co">#&gt;  [7,]           1          0       0</span>
<span class="co">#&gt;  [8,]           0          1       0</span>
<span class="co">#&gt;  [9,]           1          0       0</span></code></pre></div>
<p>Once we have the matrix with the likelihood of the states we can chose the most probable state at each node using the <code><a href="https://rdrr.io/r/base/maxCol.html" class="external-link">max.col()</a></code> function. Here we need to make a decision that will have downstream consequences for the DAISIE data extracted from the tree, which is when a node has island presence and absence equally probable we need to decide whether that species should be considered on the island. To consider it on the island use <code>ties.method = "last"</code> in the <code><a href="https://rdrr.io/r/base/maxCol.html" class="external-link">max.col()</a></code> function, if you consider it not on the island use <code>ties.method = "first"</code>. For this example we will assume that species are on the island, but for completeness it may be worth running both and then seeing if there are significant downstream consequences.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">node_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/maxCol.html" class="external-link">max.col</a></span><span class="op">(</span><span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span>, ties.method <span class="op">=</span> <span class="st">"last"</span><span class="op">)</span></code></pre></div>
<p>#TODO: give examples of other asr methods from castor.</p>
<p>These values can now be converted back to string to make them more readable.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">node_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>
  pattern <span class="op">=</span> <span class="st">"1"</span>, replacement <span class="op">=</span> <span class="st">"not_present"</span>, x <span class="op">=</span> <span class="va">node_states</span>
<span class="op">)</span>
<span class="va">node_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>
  pattern <span class="op">=</span> <span class="st">"2"</span>, replacement <span class="op">=</span> <span class="st">"nonendemic"</span>, x <span class="op">=</span> <span class="va">node_states</span>
<span class="op">)</span>
<span class="va">node_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>
  pattern <span class="op">=</span> <span class="st">"3"</span>, replacement <span class="op">=</span> <span class="st">"endemic"</span>, x <span class="op">=</span> <span class="va">node_states</span>
<span class="op">)</span></code></pre></div>
<p>Now the ancestral states at the nodes is available we can combine it into our <code>phylod</code> object.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">node_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  island_status <span class="op">=</span> <span class="va">node_states</span>,
  endemic_prob <span class="op">=</span> <span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span><span class="op">[</span>, <span class="st">"endemic"</span><span class="op">]</span>,
  nonendemic_prob <span class="op">=</span> <span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span><span class="op">[</span>, <span class="st">"nonendemic"</span><span class="op">]</span>,
  not_present_prob <span class="op">=</span> <span class="va">asr</span><span class="op">$</span><span class="va">ancestral_likelihoods</span><span class="op">[</span>, <span class="st">"not_present"</span><span class="op">]</span>,
  row.names <span class="op">=</span> <span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/nodeId-methods.html" class="external-link">nodeId</a></span><span class="op">(</span><span class="va">phylod</span>, <span class="st">"internal"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">phylod</span> <span class="op">&lt;-</span> <span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/phylo4d-methods.html" class="external-link">phylo4d</a></span><span class="op">(</span>
  <span class="va">phylo</span>,
  tip.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">endemicity_status</span><span class="op">)</span>,
  node.data <span class="op">=</span> <span class="va">node_data</span>
<span class="op">)</span></code></pre></div>
<p>The details above are given to make it clear the process involved in reconstructing and assigning node states. However, to make this step easier the above steps are in the <code>add_asr_node_states</code> function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_asr_node_states.html">add_asr_node_states</a></span><span class="op">(</span>phylod <span class="op">=</span> <span class="va">phylod</span>, asr_method <span class="op">=</span> <span class="st">"parsimony"</span><span class="op">)</span></code></pre></div>
<p>Lastly, we can plot the phylogeny, this time with the node labels for the ancestral island presence.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_phylod.html">plot_phylod</a></span><span class="op">(</span>phylod <span class="op">=</span> <span class="va">phylod</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot%20phylogeny%20with%20tip%20and%20node%20data-1.png" width="700"></p>
<p>Quick sidenote: if you are wondering what the probabilities are at each node and whether this should influence your decision to pick a preference for island or mainland when the likelihood for each state are equal we can plot the probabilities at the nodes to visualise the ancestral state reconstruction.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_phylod.html">plot_phylod</a></span><span class="op">(</span>phylod <span class="op">=</span> <span class="va">phylod</span>, node_pies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot%20ancestral%20state%20likelihoods-1.png" width="700"></p>
<p>Now we can extract the colonisation and diversification from the phylogeny using the ancestral reconstructed island presence/absence.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_island_species.html">extract_island_species</a></span><span class="op">(</span>
  phylod <span class="op">=</span> <span class="va">phylod</span>, 
  extraction_method <span class="op">=</span> <span class="st">"asr"</span>
<span class="op">)</span></code></pre></div>
<p>In the previous example we used a single phylogeny and extracted the colonisation and branching events from it. However, it could be the case that island species are from different phylogenies. Here we look at the case of the birds of the GalÃ pagos archipelago (excluding birds of prey). There are 8 phylogenies to extract the colonisation and diversification date from.</p>
<p>First the phylogenies need to be loaded using the function <code>read.nexus</code> from the R package <code>ape</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coccyzus_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Coccyzus.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">columbiformes_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Columbiformes.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">finches_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Finches.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">mimus_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Mimus.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">myiarchus_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Myiarchus.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">progne_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Progne.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">pyrocephalus_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Pyrocephalus.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">setophaga_tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Setophaga.tre"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Currently the phylogenies are loaded as S3 phylo objects, however, we want to convert them into S4 phylobase objects.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coccyzus_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">coccyzus_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span>
<span class="va">columbiformes_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">columbiformes_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span>
<span class="va">finches_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">finches_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span>
<span class="va">mimus_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">mimus_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span>
<span class="va">myiarchus_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">myiarchus_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span>
<span class="va">progne_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">progne_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span>
<span class="va">pyrocephalus_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">pyrocephalus_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span>
<span class="va">setophaga_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/setAs-methods.html" class="external-link">as</a></span><span class="op">(</span><span class="va">setophaga_tree</span>, <span class="st">"phylo4"</span><span class="op">)</span></code></pre></div>
<p>Now that all of the phylogenies are loaded we can inspect them.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/treePlot-methods.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coccyzus_tree</span>, cex <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We can now use a table (data frame) of the species that are on the island and their island endemicity status.</p>
<p>The species names on the tree (tips labels) can be extracted by using <code>phylobase::tiplabels(coccyzus_tree)</code>. Make sure the spelling matches exactly including any whitespace and underscores, and the case of the names.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  tip_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Coccyzus_melacoryphus_GALAPAGOS_L569A"</span>,
                 <span class="st">"Coccyzus_melacoryphus_GALAPAGOS_L571A"</span><span class="op">)</span>,
  tip_endemicity_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nonendemic"</span>, <span class="st">"nonendemic"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">endemicity_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_endemicity_status.html">create_endemicity_status</a></span><span class="op">(</span>
  phylo <span class="op">=</span> <span class="va">coccyzus_tree</span>,
  island_species <span class="op">=</span> <span class="va">island_species</span>
<span class="op">)</span>

<span class="va">phylod</span> <span class="op">&lt;-</span> <span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/phylo4d-methods.html" class="external-link">phylo4d</a></span><span class="op">(</span><span class="va">coccyzus_tree</span>, <span class="va">endemicity_status</span><span class="op">)</span></code></pre></div>
<p>We can plot the endemicity status of these species.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_phylod.html">plot_phylod</a></span><span class="op">(</span>phylod <span class="op">=</span> <span class="va">phylod</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot%20coccyzus%20phylogeny%20with%20tip%20data-1.png" width="700"></p>
<p>TODO change colours: not_present in black, nonendemic in blue, endemic in red.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_island_species.html">extract_island_species</a></span><span class="op">(</span>
  phylod <span class="op">=</span> <span class="va">phylod</span>, 
  extraction_method <span class="op">=</span> <span class="st">"min"</span>
<span class="op">)</span></code></pre></div>
<p>Instead of assigning the endemicity to each of the Galapagos bird phylogenies and converting them to <code>phylo4d</code> objects, this has already been done and the data objects have been prepared in advance and are ready to be used.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coccyzus_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"coccyzus_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">columbiformes_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>
    <span class="st">"extdata"</span>, <span class="st">"columbiformes_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">finches_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"finches_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">mimus_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mimus_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">myiarchus_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"myiarchus_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">progne_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"progne_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">pyrocephalus_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>
    <span class="st">"extdata"</span>, <span class="st">"pyrocephalus_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">setophaga_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"setophaga_phylod.rds"</span>, package <span class="op">=</span> <span class="st">"DAISIEprep"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Now that we have all our data in the correct format, we are ready to extract the island data from these trees using <code><a href="../reference/extract_island_species.html">extract_island_species()</a></code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_island_species.html">extract_island_species</a></span><span class="op">(</span>
  phylod <span class="op">=</span> <span class="va">coccyzus_phylod</span>,
  extraction_method <span class="op">=</span> <span class="st">"min"</span>,
  island_tbl <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
<p>We can now loop through the rest of the Galapagos colonists and add them to the island data.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">galapagos_phylod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  <span class="va">coccyzus_phylod</span>, <span class="va">columbiformes_phylod</span>, <span class="va">finches_phylod</span>, <span class="va">mimus_phylod</span>,
  <span class="va">myiarchus_phylod</span>, <span class="va">progne_phylod</span>, <span class="va">pyrocephalus_phylod</span>, <span class="va">setophaga_phylod</span>
<span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">phylod</span> <span class="kw">in</span> <span class="va">galapagos_phylod</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">island_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_island_species.html">extract_island_species</a></span><span class="op">(</span>
    phylod <span class="op">=</span> <span class="va">phylod</span>,
    extraction_method <span class="op">=</span> <span class="st">"min"</span>,
    island_tbl <span class="op">=</span> <span class="va">island_tbl</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">island_tbl</span>
<span class="co">#&gt; Class:  Island_tbl </span>
<span class="co">#&gt;                            clade_name     status missing_species</span>
<span class="co">#&gt; 1               Coccyzus_melacoryphus nonendemic               0</span>
<span class="co">#&gt; 2               Zenaida_galapagoensis    endemic               0</span>
<span class="co">#&gt; 3                               C_fus    endemic               0</span>
<span class="co">#&gt; 4 Mimus_macdonaldi_GALAPAGOS_KF411075    endemic               0</span>
<span class="co">#&gt; 5                      M_magnirostris    endemic               0</span>
<span class="co">#&gt; 6 Pyrocephalus_dubius_Galapagos_cas01    endemic               0</span>
<span class="co">#&gt; 7                          D_petechia nonendemic               0</span>
<span class="co">#&gt;   branching_times   min_age</span>
<span class="co">#&gt; 1    1.789425.... 0.5483906</span>
<span class="co">#&gt; 2    3.193372.... 0.0502533</span>
<span class="co">#&gt; 3    3.0282, ....        NA</span>
<span class="co">#&gt; 4    4.485328....        NA</span>
<span class="co">#&gt; 5    0.854474.... 0.2229886</span>
<span class="co">#&gt; 6    1.151454....        NA</span>
<span class="co">#&gt; 7    0.140001.... 0.0579464</span></code></pre></div>
<p>To see an example of the DAISIE_datatable object see</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Galapagos_datatable"</span>, package <span class="op">=</span> <span class="st">"DAISIE"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">Galapagos_datatable</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="12%">
<col width="10%">
<col width="68%">
</colgroup>
<thead><tr class="header">
<th align="left">Clade_name</th>
<th align="left">Status</th>
<th align="right">Missing_species</th>
<th align="left">Branching_times</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Coccyzus</td>
<td align="left">Non_endemic_MaxAge</td>
<td align="right">0</td>
<td align="left">7.456</td>
</tr>
<tr class="even">
<td align="left">Dendroica</td>
<td align="left">Non_endemic</td>
<td align="right">0</td>
<td align="left">0.34</td>
</tr>
<tr class="odd">
<td align="left">Finches</td>
<td align="left">Endemic</td>
<td align="right">0</td>
<td align="left">3.0282,1.3227,0.8223,0.4286,0.3462,0.245,0.0808,0.0527,0.0327,0.0221,0.118,0.0756,0.0525,0.0322,0.0118</td>
</tr>
<tr class="even">
<td align="left">Mimus</td>
<td align="left">Endemic</td>
<td align="right">0</td>
<td align="left">3.958,3.422,2.884,0.459</td>
</tr>
<tr class="odd">
<td align="left">Myiarchus</td>
<td align="left">Endemic</td>
<td align="right">0</td>
<td align="left">0.855</td>
</tr>
<tr class="even">
<td align="left">Progne</td>
<td align="left">Endemic</td>
<td align="right">0</td>
<td align="left">0.086</td>
</tr>
<tr class="odd">
<td align="left">Pyrocephalus</td>
<td align="left">Non_endemic_MaxAge</td>
<td align="right">0</td>
<td align="left">10.285</td>
</tr>
<tr class="even">
<td align="left">Zenaida</td>
<td align="left">Endemic</td>
<td align="right">0</td>
<td align="left">3.51</td>
</tr>
</tbody>
</table>
<p>Each row in the table represents an independent colonisation event. The table has four columns:</p>
<ul>
<li>
<code>Clade_name</code>: name of the independent colonisation event.</li>
<li>
<code>Status</code>: One of the following categories:
<ul>
<li>
<code>Endemic</code>: applicable for both anagenetic species and radiations.</li>
<li>
<code>Non_endemic</code>: if the taxon is not endemic to the island, and the age of the colonisation is based on a phylogeny where both island and non-island populations of the species have been sampled.</li>
<li>
<code>Non_endemic_MaxAge</code>: if the taxon is not endemic to the island, and only an upper bound to the time of colonisation of the island is known. This applies if individuals from the island population of the species have not been sampled, but an age of the species is known.</li>
<li>
<code>Endemic&amp;Non_Endemic</code> when an endemic clade is present and the mainland ancestor has re-colonised. For remote islands this is expected to be very rare.</li>
</ul>
</li>
<li>
<code>Missing_species</code>: number of island species that were not sampled for a particular clade (only applicable for radiations).</li>
<li>
<code>Branching_times</code>: this should be the stem age of the population/species in the case of <code>Non_endemic</code>, <code>Non-endemic_MaxAge</code> and <code>Endemic</code> anagenetic species. For cladogenetic species these should be branching times of the radiation including the stem age of the radiation. Note - if there are species within the radiation that are not found on the island (e.g.Â back-colonisation) the branching times of these species should be excluded, as the mainland species pool is treated as static.</li>
</ul></main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joshua W. Lambert.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
